# üì± Resumen de Correcciones Mobile - v1.0.7

## ‚úÖ **IMPLEMENTADO**

### **1. Contactos - Modal Arreglado ‚úÖ**
- **Problema:** El modal no se visualizaba correctamente
- **Soluci√≥n:** Cambiado `maxHeight: '85%'` a `height: '85%'`
- **Estado:** ‚úÖ FUNCIONAL

### **2. Contactos - Instituciones Vinculables ‚úÖ**
- **Nueva funcionalidad:** Bot√≥n "Mis Instituciones" en el header
- **Modal implementado:** 
  - Listar instituciones vinculadas (con opci√≥n de desvincular)
  - Listar todas las instituciones disponibles (con opci√≥n de vincular)
- **API endpoints usados:**
  - `usersAPI.getUserInstitutions()` - Obtener vinculadas
  - `institutionsAPI.getAll()` - Obtener todas
  - `usersAPI.linkInstitution(id)` - Vincular
  - `usersAPI.unlinkInstitution(id)` - Desvincular
- **Estado:** ‚úÖ FUNCIONAL

### **3. Actividades - Instituciones en Picker ‚úÖ**
- **Problema:** Aparec√≠a "Ninguna" aunque hab√≠a instituciones
- **Soluci√≥n:** 
  - Agregado `loadInstitutions()` que llama a `usersAPI.getUserInstitutions()`
  - El picker ahora muestra las instituciones vinculadas correctamente
- **Estado:** ‚úÖ FUNCIONAL

### **4. Actividades - Edici√≥n con Doble Tap ‚úÖ**
- **Nueva funcionalidad:** Tocar dos veces r√°pidamente una actividad para editarla
- **Implementaci√≥n:**
  - Estado `lastTap` para detectar doble tap
  - Funci√≥n `handleDoubleTap()` con delay de 300ms
  - Funci√≥n `handleEdit()` que carga datos de la actividad en el formulario
  - Modal distingue entre "Nueva Actividad" y "Editar Actividad"
- **Estado:** ‚úÖ FUNCIONAL

### **5. Actividades - Fecha y Hora ‚úÖ**
- **Nuevos campos agregados:**
  - `scheduledDate` (formato: YYYY-MM-DD)
  - `scheduledTime` (formato: HH:MM)
- **Guardado:** Se combinan en formato ISO para enviar al backend
- **Estado:** ‚úÖ FUNCIONAL (b√°sico - ver mejoras pendientes)

---

## ‚ö†Ô∏è **PENDIENTE DE IMPLEMENTAR**

### **6. Tareas - Checkboxes (Checklist) ‚è≥**
**Funcionalidad en Web:**
- Crear √≠tems de checklist con texto
- Marcar/desmarcar √≠tems completados
- Eliminar √≠tems del checklist
- Persistencia en backend

**Lo que falta en Mobile:**
1. Agregar campo `checklist: []` al formData
2. Input para agregar nuevos √≠tems
3. Lista de √≠tems con checkboxes
4. Bot√≥n para eliminar √≠tems
5. Funciones:
   - `addChecklistItem()`
   - `removeChecklistItem(index)`
   - `handleToggleCheckItem(task, itemIndex)`

**Prioridad:** üî• ALTA

### **7. Calendario - Acceso desde Mobile ‚è≥**
**Opciones de implementaci√≥n:**

#### **Opci√≥n A: Tab en barra inferior**
- Agregar icono de calendario en `src/navigation/AppNavigator.js`
- Crear `CalendarScreen.js`
- Usar librer√≠a: `react-native-calendars`
- Mostrar actividades con `scheduledDate`

#### **Opci√≥n B: Vista dentro de Actividades**
- Agregar tab "Calendario" junto a "Lista", "Pendientes", "Completadas"
- Usar `react-native-calendars`
- Implementar selecci√≥n de fecha para crear actividad

**Funcionalidades requeridas:**
- Ver actividades en calendario
- Crear actividad seleccionando fecha
- Editar actividad al tocar en el calendario
- Indicadores visuales (pendiente/completada)

**Prioridad:** üü° MEDIA

### **8. Actividades - Mejoras en Fecha/Hora ‚è≥**
**Problemas actuales:**
- Input manual de fecha (propenso a errores)
- Input manual de hora (formato 24h puede confundir)

**Mejoras sugeridas:**
- **Date Picker nativo:**
  ```javascript
  import DateTimePicker from '@react-native-community/datetimepicker';
  ```
- **Separar en dos pickers:**
  - Uno para fecha
  - Uno para hora
- **Formato m√°s amigable:**
  - Fecha: Selector con calendario visual
  - Hora: Selector con formato 12h (AM/PM) o 24h seg√∫n preferencia

**Prioridad:** üü¢ BAJA (funciona pero no es √≥ptimo)

---

## üìã **CHECKLIST DE IMPLEMENTACI√ìN**

### **Tareas Checklist (PRIORITARIO):**
- [ ] Leer estructura del checklist en `client/src/pages/Tasks.jsx`
- [ ] Agregar estado `checklist` y `newCheckItem` en TasksScreen
- [ ] Agregar secci√≥n "Checklist" en el modal
- [ ] Input para agregar nuevo √≠tem + bot√≥n
- [ ] Renderizar lista de √≠tems con checkboxes
- [ ] Implementar toggle de checkbox
- [ ] Implementar eliminar √≠tem
- [ ] Actualizar `handleSubmit()` para incluir checklist
- [ ] Agregar estilos para los checkboxes
- [ ] Probar crear tarea con checklist
- [ ] Probar marcar/desmarcar √≠tems
- [ ] Probar eliminar √≠tems

### **Calendario:**
- [ ] Decidir: ¬øTab independiente o dentro de Actividades?
- [ ] Instalar `react-native-calendars`
- [ ] Crear CalendarScreen o vista calendario
- [ ] Cargar actividades con `scheduledDate`
- [ ] Renderizar marcadores en fechas con actividades
- [ ] Implementar onDayPress para crear/ver actividad
- [ ] Agregar leyenda de colores (pendiente/completada)
- [ ] Testear navegaci√≥n y funcionalidad

### **Mejoras Fecha/Hora:**
- [ ] Instalar `@react-native-community/datetimepicker`
- [ ] Reemplazar TextInput de fecha por DateTimePicker
- [ ] Reemplazar TextInput de hora por DateTimePicker
- [ ] Ajustar formatos de fecha/hora
- [ ] Validar guardado correcto

---

## üîß **INSTRUCCIONES DE IMPLEMENTACI√ìN**

### **Para Tareas con Checklist:**

1. **Actualizar TasksScreen.js:**
```javascript
const [formData, setFormData] = useState({
  title: '',
  description: '',
  priority: 'media',
  checklist: [],  // ‚Üê AGREGAR
  // ...
});
const [newCheckItem, setNewCheckItem] = useState('');  // ‚Üê AGREGAR

// Funci√≥n para agregar √≠tem
const addChecklistItem = () => {
  if (newCheckItem.trim()) {
    setFormData({
      ...formData,
      checklist: [...formData.checklist, { text: newCheckItem.trim(), completed: false }]
    });
    setNewCheckItem('');
  }
};

// Funci√≥n para eliminar √≠tem
const removeChecklistItem = (index) => {
  setFormData({
    ...formData,
    checklist: formData.checklist.filter((_, i) => i !== index)
  });
};

// Funci√≥n para toggle de √≠tem (en tarea ya creada)
const handleToggleCheckItem = async (task, itemIndex) => {
  try {
    const updatedChecklist = [...task.checklist];
    updatedChecklist[itemIndex] = {
      ...updatedChecklist[itemIndex],
      completed: !updatedChecklist[itemIndex].completed
    };
    await tasksAPI.update(task._id, { checklist: updatedChecklist });
    loadTasks();
  } catch (error) {
    Alert.alert('Error', 'No se pudo actualizar el checklist');
  }
};
```

2. **Agregar UI en el Modal:**
```javascript
{/* Despu√©s de descripci√≥n */}
<Text style={styles.label}>Checklist</Text>
<View style={styles.checklistContainer}>
  <View style={styles.checklistInputRow}>
    <TextInput
      style={[styles.input, { flex: 1, marginBottom: 0 }]}
      value={newCheckItem}
      onChangeText={setNewCheckItem}
      placeholder="Agregar √≠tem..."
      onSubmitEditing={addChecklistItem}
    />
    <TouchableOpacity 
      style={styles.addCheckButton}
      onPress={addChecklistItem}
    >
      <Ionicons name="add" size={24} color="#fff" />
    </TouchableOpacity>
  </View>
  
  {formData.checklist.map((item, index) => (
    <View key={index} style={styles.checklistItem}>
      <TouchableOpacity 
        style={styles.checkbox}
        onPress={() => {
          const updated = [...formData.checklist];
          updated[index].completed = !updated[index].completed;
          setFormData({ ...formData, checklist: updated });
        }}
      >
        {item.completed && <Ionicons name="checkmark" size={18} color="#3b82f6" />}
      </TouchableOpacity>
      <Text style={[styles.checklistText, item.completed && styles.checklistTextCompleted]}>
        {item.text}
      </Text>
      <TouchableOpacity onPress={() => removeChecklistItem(index)}>
        <Ionicons name="close-circle" size={20} color="#ef4444" />
      </TouchableOpacity>
    </View>
  ))}
</View>
```

3. **Agregar estilos:**
```javascript
checklistContainer: {
  marginBottom: 16,
},
checklistInputRow: {
  flexDirection: 'row',
  gap: 8,
  marginBottom: 12,
},
addCheckButton: {
  backgroundColor: '#3b82f6',
  width: 48,
  height: 48,
  borderRadius: 8,
  justifyContent: 'center',
  alignItems: 'center',
},
checklistItem: {
  flexDirection: 'row',
  alignItems: 'center',
  backgroundColor: '#f9fafb',
  padding: 12,
  borderRadius: 8,
  marginBottom: 8,
  gap: 12,
},
checkbox: {
  width: 24,
  height: 24,
  borderRadius: 4,
  borderWidth: 2,
  borderColor: '#3b82f6',
  justifyContent: 'center',
  alignItems: 'center',
},
checklistText: {
  flex: 1,
  fontSize: 14,
  color: '#1f2937',
},
checklistTextCompleted: {
  textDecorationLine: 'line-through',
  color: '#9ca3af',
},
```

### **Para Calendario (Opci√≥n m√°s simple - Vista en Actividades):**

1. **Instalar librer√≠a:**
```bash
npm install react-native-calendars
```

2. **Agregar vista Calendario en ActivitiesScreen:**
```javascript
import { Calendar } from 'react-native-calendars';

// En el estado
const [viewMode, setViewMode] = useState('list'); // agregar 'calendar'

// En el JSX
{viewMode === 'calendar' && (
  <Calendar
    markedDates={getMarkedDates()}
    onDayPress={(day) => {
      setFormData({ ...formData, scheduledDate: day.dateString });
      setModalVisible(true);
    }}
    theme={{
      todayTextColor: '#3b82f6',
      selectedDayBackgroundColor: '#3b82f6',
    }}
  />
)}

// Funci√≥n helper
const getMarkedDates = () => {
  const marked = {};
  filteredActivities.forEach(activity => {
    if (activity.scheduledDate) {
      const date = activity.scheduledDate.split('T')[0];
      marked[date] = {
        marked: true,
        dotColor: activity.status === 'completada' ? '#10b981' : '#f59e0b'
      };
    }
  });
  return marked;
};
```

---

## üöÄ **SIGUIENTE APK: v1.0.7**

**Incluir√°:**
- ‚úÖ Modal de contactos arreglado
- ‚úÖ Instituciones vinculables
- ‚úÖ Actividades editables (doble tap)
- ‚úÖ Fecha y hora en actividades
- ‚úÖ Picker de instituciones funcional
- ‚è≥ **FALTA:** Checklist en tareas
- ‚è≥ **FALTA:** Calendario

**Para generar APK despu√©s de implementar checklist y calendario:**
```bash
cd mobile
set EAS_NO_VCS=1 && eas build -p android --profile preview
```

---

## üìä **Estado General**

| Funcionalidad | Web | Mobile Actual | Mobile Target |
|---------------|-----|---------------|---------------|
| Contactos - Modal | ‚úÖ | ‚úÖ | ‚úÖ |
| Contactos - Instituciones | ‚úÖ | ‚úÖ | ‚úÖ |
| Actividades - Editar | ‚úÖ | ‚úÖ | ‚úÖ |
| Actividades - Fecha/Hora | ‚úÖ | ‚úÖ‚ö†Ô∏è | ‚úÖ (mejorar UI) |
| Actividades - Instituciones | ‚úÖ | ‚úÖ | ‚úÖ |
| Actividades - Calendario | ‚úÖ | ‚ùå | ‚è≥ |
| Tareas - Checklist | ‚úÖ | ‚ùå | ‚è≥ |

**Leyenda:**
- ‚úÖ Implementado y funcional
- ‚úÖ‚ö†Ô∏è Implementado pero mejorable
- ‚è≥ En progreso / Pendiente
- ‚ùå No implementado

---

**√öltima actualizaci√≥n:** 2025-10-06 16:37:00
**Versi√≥n actual:** 1.0.6
**Pr√≥xima versi√≥n:** 1.0.7 (con checklist y calendario)
